"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const b=require("./index4.js"),v="--self-reload--";function A(r,l=[],a={forceReload:!1}){const{statusHolder:e,PromiseWrapper:n}=g(a,r),s=b.atom(n(...l));s.debugLabel="reloadable__reloadablePromiseAtom";const t=b.atom(0);t.debugLabel="reloadable__resetAtom";const m=v,y=b.atom((i,{setSelf:u})=>{const c=e.value,d=i(s);return i(t),c.state==="init"&&(e.value={state:"loading"},d.then(o=>(e.value=o,u(m),o)).catch(o=>{e.value={state:"hasError",error:o},u(m)})),e.value},(i,u,c)=>{if(c===v){u(t,i(t)+1);return}const d=e.value,{state:o}=d;if(o==="loading"||o==="init")return;const[h,f]=p(c,l,a);o==="hasData"?f!=null&&f.forceReload&&(e.value={state:"init"},u(s,n(...h))):(e.value={state:"init"},u(s,n(...h)))});return y.debugLabel="reloadable__reloadableAtom",y}function g(r,l){const a={value:{state:"init"}},e={count:r.retry||0,init:!1},n=async(...s)=>{try{return e.init?e.count--:(e.init=!0,e.count=r.retry||0),{state:"hasData",data:await l(...s)}}catch(t){return e.count>0?await n(...s):(e.init=!1,r.printError&&console.error(t),t instanceof Error?{state:"hasError",error:t.message}:{state:"hasError",error:t})}};return{statusHolder:a,PromiseWrapper:n}}function p(r,l,a){if(Array.isArray(r))return[r,a];if(typeof(r==null?void 0:r.options)=="object"){const e=r;return[e.args||l,e.options||a]}else return E(r),[l,a]}function E(r){if(r!==void 0&&!Array.isArray(r)&&typeof r!="object")throw new Error("reloadable atom should be called with one of the types: array(function's argument), { args?:[], } ")}exports.reloadable=A;
